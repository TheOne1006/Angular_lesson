<!doctype html> 
<html ng-app='myApp'>
    <head>
        <title>路由 - ngRoute -路由事件</title>
        <meta name='description' content='augnular 权威指南 学习版本1.2.26'>
        <link rel="stylesheet" href="/angular/docs/components/bootstrap-3.1.1/css/bootstrap.css">

        <script src='../../angular.js'></script>
        <script src='../../angular-route.js'></script>

        <script>
        var app = angular.module('myApp',['ngRoute']);
        app.config(['$locationProvider', function ($locationProvider) {
            /**
             * 显式指定 路由模式，默认为 hashbang
             */
            $locationProvider.html5Mode(false);    // 显式指定 标签模式 hashbang
            $locationProvider.hashPrefix('!');     // #！ 配置 比较老的浏览器的降级处理

        }]);
        app.config(['$routeProvider', function ($routeProvider) {
            $routeProvider
                .when('/',{
                    templateUrl:'view/home.html'
                })
                // index/all
                .when('/inbox/:name',{ // 路径转化为 {name: all}
                    template: 'IS Template' 
                })
                //默认，以及找不到匹配的 #路径
                .otherwise({redirectTo:'/'});
        }]);

        /**
         * 路由事件，
         * 1、设置监听 $on
         * 2、$routeChangeStart
         * 3、$routeChangeSuccess
         * 4、$routeChangeError
         */
         app.run(['$rootScope', '$location', function ($rootScope, $location) {
            // 
             $rootScope.$on('$routeChangeStart', function (evt, next, current){ 
                // 变化之前触发 $routeChangeStart 
                // 路由服务会开始加载所需要的所有依赖,
                // 模板和resolve 键中的 promise 也会被 resolve
                console.log(evt);
                console.log(next);
                console.log(current);
                alert('更换route开始');
             });
             $rootScope.$on('$routeChangeSuccess', function (evt, next, previous) {
                // 原始ng evt 对象
                // 用户所在路由
                // 上一个路由，如果是第一个， 则为 undefined
                 console.log(evt);
                 console.log(next);
                 console.log(previous);
                 alert('更换route成功');
             });

             // error
             $rootScope.$on('$routeChangeError',function (current, previous, rejection) {
                 console.log(current);
                 console.log(previous);
                 console.log(rejection);
                 alert('更换route ERROR');
             } );
         }]);
        </script>

    </head>
    <body>
        <header>
            <h1>HEAD</h1>
        </header>
        <div class="content">
            <a href="#!/inbox/all">切换inbox</a>
            <a href="#!/">切换HOME</a>
            <div ng-view></div>
        </div>
        <footer>
            <h5>FOOT</h5>
        </footer>
    </body>
    <script>

    </script>
</html>

